Resources:
   CMSApi:
    Type: "AWS::ApiGateway::RestApi"
    Properties:
      Description: "test Api"
      Name: "CMS-opeartion-api"  
   PostMethod: 
    Type: "AWS::ApiGateway::Method"
    Properties: 
     RestApiId: !Ref CMSApi
     ResourceId: 
       Fn::GetAtt: 
        - "CMSApi"
        - "RootResourceId"
     HttpMethod: "POST"
     RequestParameters:
       method.request.header.Cookie: False
     AuthorizationType: "NONE"
     Integration: 
       Type: "MOCK"
       IntegrationResponses: 
          - ResponseParameters:
              method.response.header.Set-Cookie: "integration.response.body.Set-Cookie"
              method.response.header.Access-Control-Allow-Credentials: "'true'"
#              method.response.header.Access-Control-Allow-Origin:
#                !Sub | 
#                  - "'https://s3-${AWS::Region}.amazonaws.com'"             
            ResponseTemplates:
              application/json: "$input.body"
            StatusCode: "200"
          - ResponseParameters:
              method.response.header.Set-Cookie: "integration.response.body.Set-Cookie"
              method.response.header.Access-Control-Allow-Credentials: "'true'"
#              method.response.header.Access-Control-Allow-Origin:
#                !Sub | 
#                  - "'https://s3-${AWS::Region}.amazonaws.com'"             
            ResponseTemplates:
              application/json: "$input.path('$.errorMessage')"
            SelectionPattern: ".*'status': 400.*"
            StatusCode: "400"            
              
#       PassthroughBehavior: "NEVER"
#       IntegrationHttpMethod: "POST"
#       Uri: 
#        !Sub | 
#          - arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${!lambdaFunctionArn}/invocations
#          - {lambdaFunctionArn: arn:aws:lambda:ap-southeast-1:216184389560:function:my-cms-aws-cms-Controller}
       RequestTemplates:
         "application/json": "{'statusCode': 200}"
     MethodResponses:
       - ResponseModels:
           application/json: Empty
         ResponseParameters:
           method.response.header.Set-Cookie: False
           method.response.header.Access-Control-Allow-Credentials: False
           method.response.header.Access-Control-Allow-Origin: False
         StatusCode: "200"
       - ResponseModels:
           application/json: Empty
         ResponseParameters:
           method.response.header.Access-Control-Allow-Credentials: False
           method.response.header.Access-Control-Allow-Origin: False
         StatusCode: "400"
   OptionsMethod: 
    Type: "AWS::ApiGateway::Method"
    Properties: 
     RestApiId: !Ref CMSApi
     ResourceId: 
       Fn::GetAtt: 
        - "CMSApi"
        - "RootResourceId"
     HttpMethod: "OPTIONS"
     AuthorizationType: "NONE"
     Integration: 
       Type: "MOCK"
       IntegrationResponses: 
          - ResponseParameters:
#              method.response.header.Access-Control-Allow-Headers: 
#                "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,Cookie,Accept,Access-Control-Allow-Origin'" 
              method.response.header.Access-Control-Allow-Credentials: "'true'"
              method.response.header.Access-Control-Allow-Methods: "'POST,OPTIONS'"
#              method.response.header.Access-Control-Allow-Origin:
#                !Sub | 
#                  - "'https://s3-${AWS::Region}.amazonaws.com'"             
            ResponseTemplates:
              application/json: ""
            StatusCode: "200"
       RequestTemplates:
         "application/json": "{'statusCode': 200}"        
     MethodResponses:
       - ResponseModels:
           application/json: Empty
         ResponseParameters:
           method.response.header.Set-Cookie: False
           method.response.header.Access-Control-Allow-Credentials: False
           method.response.header.Access-Control-Allow-Origin: False
           method.response.header.Access-Control-Allow-Methods: False
         StatusCode: "200"        
          
Outputs:
   ApiId:
     Description: API ID
     Value: !Ref CMSApi
   ApiUrl:
     Description: API Url
     Value: 
       !Sub | 
         - https://${!apiId}.execute-api.${AWS::Region}.amazonaws.com/prod # for non presudo variable or custom variable use #${!varaibleName}
         - { apiId: !Ref CMSApi }
   ApiPermissionsUri:
     Description: API Permissions Uri
     Value: 
       !Sub |
        - arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${!apiId}/*/POST/
        - { apiId:  !Ref CMSApi }
    
      